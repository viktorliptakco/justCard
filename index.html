<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Fckn card</title>
</head>
<body>

    <div class="cards">
        <h3>GoT</h3>
        <h4>card</h4>
        <div class="card card__one">
            <div class="card__bg"></div>
            <img class="card__img" src="viktorGOT.png" />
            <div class="card__text">
            <p class="card__title">Talbert Storm</p>
            </div>
        </div>
    </div>

   

                
    <script>

        const cards = document.querySelector(".cards");
        const images = document.querySelectorAll(".card__img");
        const backgrounds = document.querySelectorAll(".card__bg");
        const range = 40;

        // const calcValue = (a, b) => (((a * 100) / b) * (range / 100) -(range / 2)).toFixed(1);
        const calcValue = (a, b) => ((a / b) * range - range / 2).toFixed(1); // thanks @alice-mx

        let timeout;
        /*document.addEventListener(
        "mousemove",
        ({ x, y }) => {
            if (timeout) {
            window.cancelAnimationFrame(timeout);
            }

            timeout = window.requestAnimationFrame(() => {
            const yValue = calcValue(y, window.innerHeight);
            const xValue = calcValue(x, window.innerWidth);

            cards.style.transform = `rotateX(${-yValue}deg) rotateY(${xValue}deg)`;

            [].forEach.call(images, (image) => {
                image.style.transform = `translateX(${-xValue}px) translateY(${yValue}px)`;
            });

            [].forEach.call(backgrounds, (background) => {
                background.style.backgroundPosition = `${xValue * 0.45}px ${
                -yValue * 0.45
                }px`;
            });
            });
        },
        false
        );*/

        /*window.addEventListener(
        "deviceorientation",
        ({ alpha, beta, gamma }) => {
            if (timeout) {
            window.cancelAnimationFrame(timeout);
            }

            timeout = window.requestAnimationFrame(() => {
            const yValue = calcValue(beta, 180);
            const xValue = calcValue(gamma, 180);

            cards.style.perspective = `${window.innerHeight * 2}px`;
            //cards.style.transform = `rotateX(${yValue}deg) rotateY(${xValue}deg)`;

            [].forEach.call(images, (image) => {
                image.style.transform = `translateX(${-xValue}px) translateY(${yValue}px)`;
            });

            [].forEach.call(backgrounds, (background) => {
                background.style.backgroundPosition = `${xValue * 0.45}px ${
                -yValue * 0.45
                }px`;
            });
            });
        },
        false
        );*/

        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        //MOUSE DEVICES
        if (! isTouchDevice) { 
            //console.log('Zariadenie nemá dotykovú obrazovku');
   
            //CARD EFFECT FOR LAPTOP/MAC/PC
            document.addEventListener('mousemove', ({ x, y }) => {
                if (timeout) {
                    window.cancelAnimationFrame(timeout);
                }

                timeout = window.requestAnimationFrame(() => {
                const yValue = calcValue(y, window.innerHeight);
                const xValue = calcValue(x, window.innerWidth);

                //CONTROL CARD ROTATION
                cards.style.transform = `rotateX(${yValue}deg) rotateY(${-xValue}deg)`;

                //CONTROLL IMAGE POSITION
                [].forEach.call(images, (image) => {
                    image.style.transform = `translateX(${xValue * 0.75}px) translateY(${yValue * 0.75}px)`;
                });

                //CONTROLL BACKGROUND POSITION
                [].forEach.call(backgrounds, (background) => {
                    background.style.backgroundPosition = `${xValue * 2}px ${yValue * 2}px`;
                });
                });
            },
            false
            );
        }

        //TOUCHSCREENDEVICES
        else {
            //console.log('Zariadenie ma dotykovú obrazovku');

            //CARD EFFECT FOR ANDROID/ *ios*
            window.addEventListener('deviceorientation',({ alpha, beta, gamma }) => {
                if (timeout) {
                window.cancelAnimationFrame(timeout);
                }

                timeout = window.requestAnimationFrame(() => {
                const yValue = calcValue(beta, 90);
                const xValue = calcValue(gamma, 180);

                cards.style.perspective = `${window.innerHeight * 2}px`;
                //cards.style.transform = `rotateX(${yValue}deg) rotateY(${xValue}deg)`;

                //CONTROLL IMAGE POSITION
                [].forEach.call(images, (image) => {
                    image.style.transform = `translateX(${xValue * 0.8}px) translateY(${yValue * 0.8}px)`;
                });

                //CONTROLL BACKGROUND POSITION
                [].forEach.call(backgrounds, (background) => {
                    background.style.backgroundPosition = `${xValue * 1.25}px ${yValue * 1.25}px`;
                });
                });
            },
            false
            );
        }

    </script>
</body>
</html>